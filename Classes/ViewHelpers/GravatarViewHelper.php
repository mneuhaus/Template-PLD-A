<?php

/* * *************************************************************
 *  Copyright notice
 *
 *  (c) 2010 Claus Due <claus@wildside.dk>, Wildside A/S
 *
 *  All rights reserved
 *
 *  This script is part of the TYPO3 project. The TYPO3 project is
 *  free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  The GNU General Public License can be found at
 *  http://www.gnu.org/copyleft/gpl.html.
 *
 *  This script is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  This copyright notice MUST APPEAR in all copies of the script!
 * ************************************************************* */

/**
 * I f'ing love Coffee.
 *
 * This ViewHelper lets you render a Partial Fluid template containing
 * Javascript - in other words, "Java Script Fluid", popularly known as "Coffee"
 *
 * Does exactly what fed:script does, except uses Fluid with a special pattern
 * when parsing the file or tag content.
 *
 * @author Claus Due, Wildside A/S
 * @package Fed
 * @subpackage ViewHelpers\Extbase\Widget
 */
class Tx_Plda_ViewHelpers_GravatarViewHelper extends Tx_Fed_Core_ViewHelper_AbstractViewHelper {

	/**
	 * Make coffee.
	 *
	 * @param string $email
	 * @param string $width
	 * @return string
	 */
	public function render($email, $width="200") {
		$avatars = array(
			"blabla@foo.com" => "data:image/jpeg;base64,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"
		);
		if(isset($avatars[$email])){
			$url = $avatars[$email];
		}else {
			$hash = md5($email);
			$url = 'http://www.gravatar.com/avatar/'.$hash.'?s='.$width;
		}
		return '<img src="'.$url.'" width="'.$width.'"/>';
	}

}
